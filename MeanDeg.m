

file='path to image';

clear c m n cb puntos deg nodes k1 k2 k3

c=imread(file);
[m,n]=size(c);

th=graythresh(c);
cb=im2bw(c, th);
puntos = bwmorph(cb, 'skel', Inf);

%contour=dd
dd=160;
c(1:m+(dd*2),1:n+(dd*2))=0;
c(dd:m+dd-1,dd:n+dd-1)=puntos(1:m,1:n);

im=cat(3,c,c,c);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

[m,n]=size(c);
d=1;

[i1,j1]=find(c==1);
largo=length(i1);

nodo=0;
deg=0;
nodes=0;

k1=0;
k2=0;
k3=0;
for tri=1:largo
	nodo=nodo+1;
	x=i1(tri);
	y=j1(tri);   

	%neighbors
	p(1)=(c(x,y+d));
	p(2)=(c(x+d,y+d));
	p(3)=(c(x+d,y));
	p(4)=(c(x+d,y-d));
	p(5)=(c(x,y-d));
	p(6)=(c(x-d,y-d));
	p(7)=(c(x-d,y));
	p(8)=(c(x-d,y+d)); 

	grado(nodo)=sum(p);


	if grado(nodo)==1
		im(x,y,1)=255;
		im(x,y,2)=0;
		im(x,y,3)=0;
		deg=deg+1;
		k1=k1+1;
	end


	if grado(nodo)==2
		n1=p(8)+p(1);
		n2=p(1)+p(2);
		n3=p(2)+p(3);
		n4=p(3)+p(4);
		n5=p(4)+p(5);
		n6=p(5)+p(6);
		n7=p(6)+p(7);
		n8=p(7)+p(8);

		if n1==2 | n2==2 | n3==2 | n4==2 | n5==2 | n6==2 | n7==2 | n8==2
			im(x,y,1)=255;
			im(x,y,2)=0;
			im(x,y,3)=0;
			deg=deg+1;
			k1=k1+1;
		else
			im(x,y,1)=255;
			im(x,y,2)=255;
			im(x,y,3)=255;
			deg=deg+2;
			k2=k2+1;
		end
	end


	if grado(nodo)==3
		n9=p(1)+p(7)+p(3);
		n10=p(1)+p(5)+p(3);
		n11=p(7)+p(5)+p(3);
		n12=p(7)+p(1)+p(5);
		n13=p(8)+p(6)+p(4);
		n14=p(6)+p(2)+p(8);
		n15=p(8)+p(2)+p(4);
		n16=p(6)+p(4)+p(2);
		n17=p(1)+p(4)+p(6);
		n18=p(8)+p(3)+p(6);
		n19=p(7)+p(2)+p(4);
		n20=p(2)+p(5)+p(8);
		n21=p(2)+p(5)+p(7);
		n22=p(1)+p(4)+p(7);
		n23=p(3)+p(5)+p(8);
		n24=p(1)+p(3)+p(6);

		if n9==3 | n10==3 | n11==3 | n12==3 | n13==3 | n14==3 | n15==3 | n16==3 | n17==3 | n18==3 | n19==3 | n20==3 | n21==3 | n22==3 | n23==3 | n24==3
			im(x,y,1)=0;
			im(x,y,2)=0;
			im(x,y,3)=255;
			deg=deg+3;
			k3=k3+1;
		else
			im(x,y,1)=255;
			im(x,y,2)=255;
			im(x,y,3)=255;
			deg=deg+2;
			k2=k2+1;
		end
	end


	if grado(nodo)==4
		n25=p(8)+p(3)+p(5)+p(6);
		n26=p(8)+p(2)+p(5)+p(7);
		n27=p(1)+p(2)+p(4)+p(7);
		n28=p(1)+p(3)+p(4)+p(6);
		n29=p(1)+p(3)+p(5)+p(6);
		n30=p(8)+p(3)+p(5)+p(7);
		n31=p(1)+p(2)+p(5)+p(7);
		n32=p(1)+p(3)+p(4)+p(7);
		n33=p(2)+p(4)+p(5)+p(7);
		n34=p(1)+p(4)+p(6)+p(7);
		n35=p(1)+p(3)+p(6)+p(8);
		n36=p(2)+p(3)+p(5)+p(8);
		n37=p(1)+p(4)+p(5)+p(7);
		n38=p(1)+p(3)+p(6)+p(7);
		n39=p(1)+p(3)+p(5)+p(8);
		n40=p(2)+p(3)+p(5)+p(7);
		n41=p(1)+p(2)+p(3)+p(6);
		n42=p(3)+p(4)+p(5)+p(8);
		n43=p(2)+p(5)+p(6)+p(7);
		n44=p(1)+p(4)+p(7)+p(8);
		n45=p(1)+p(2)+p(3)+p(7);
		n46=p(1)+p(3)+p(4)+p(5);
		n47=p(3)+p(5)+p(6)+p(7);
		n48=p(1)+p(5)+p(7)+p(8);
		n49=p(3)+p(4)+p(5)+p(7);
		n50=p(1)+p(5)+p(6)+p(7);
		n51=p(1)+p(3)+p(7)+p(8);
		n52=p(1)+p(2)+p(3)+p(5);
		n53=p(1)+p(3)+p(5)+p(7);
		n54=p(2)+p(4)+p(6)+p(8);

		if n25==4 | n26==4 | n27==4 | n28==4 | n29==4 | n30==4 | n31==4 | n32==4 | n33==4 | n34==4 | n35==4 | n36==4 | n37==4 | n38==4 | n39==4 | n40==4 | n41==4 | n42==4 | n43==4 | n44==4 | n45==4 | n46==4 | n47==4 | n48==4 | n49==4 | n50==4 | n51==4 | n52==4 | n53==4 | n54==4;
			im(x,y,1)=0;
			im(x,y,2)=0;
			im(x,y,3)=255;
			deg=deg+3;
			k3=k3+1;
		elseif n53==4 | n54==4;
			im(x,y,1)=0;
			im(x,y,2)=255;
			im(x,y,3)=0;
			deg=deg+4;
			k4=k4+1;
		else
			im(x,y,1)=255;
			im(x,y,2)=255;
			im(x,y,3)=255;
			deg=deg+2;
			k2=k2+1;
		end
	end


	if grado(nodo)==5
		n55=p(3)+p(4)+p(5)+p(6)+p(8);
		n56=p(2)+p(5)+p(6)+p(7)+p(8);
		n57=p(1)+p(2)+p(4)+p(7)+p(8);
		n58=p(1)+p(2)+p(3)+p(4)+p(6);
		n59=p(1)+p(3)+p(4)+p(5)+p(6);
		n60=p(3)+p(5)+p(6)+p(7)+p(8);
		n61=p(1)+p(2)+p(5)+p(7)+p(8);
		n62=p(1)+p(2)+p(3)+p(4)+p(7);
		n63=p(2)+p(4)+p(5)+p(6)+p(7);
		n64=p(1)+p(4)+p(6)+p(7)+p(8);
		n65=p(1)+p(2)+p(3)+p(6)+p(8);
		n66=p(2)+p(3)+p(4)+p(5)+p(8);
		n67=p(1)+p(4)+p(5)+p(6)+p(7);
		n68=p(1)+p(3)+p(6)+p(7)+p(8);
		n69=p(1)+p(2)+p(3)+p(5)+p(8);
		n70=p(2)+p(3)+p(4)+p(5)+p(7);
		n71=p(2)+p(4)+p(6)+p(7)+p(8);
		n72=p(1)+p(2)+p(4)+p(6)+p(8);
		n73=p(2)+p(3)+p(4)+p(6)+p(8);
		n74=p(2)+p(4)+p(5)+p(6)+p(8);
		n75=p(1)+p(3)+p(5)+p(7)+p(8);
		n76=p(1)+p(2)+p(3)+p(5)+p(7);
		n77=p(1)+p(3)+p(4)+p(5)+p(7);
		n78=p(1)+p(3)+p(5)+p(6)+p(7);
		n79=p(1)+p(2)+p(3)+p(5)+p(6);
		n80=p(3)+p(4)+p(5)+p(7)+p(8);
		n81=p(1)+p(2)+p(5)+p(6)+p(7);
		n82=p(1)+p(3)+p(4)+p(7)+p(8);
		n83=p(1)+p(3)+p(4)+p(5)+p(8);
		n84=p(1)+p(2)+p(5)+p(6)+p(7);
		n85=p(1)+p(4)+p(5)+p(7)+p(8);
		n86=p(1)+p(2)+p(3)+p(6)+p(7);
		n87=p(1)+p(2)+p(4)+p(5)+p(7);
		n88=p(1)+p(3)+p(4)+p(6)+p(7);
		n89=p(1)+p(3)+p(5)+p(6)+p(8);
		n90=p(2)+p(3)+p(5)+p(7)+p(8);

		if n55==5 | n56==5 | n57==5 | n58==5 | n59==5 | n60==5 | n61==5 | n62==5 | n63==5 | n64==5 | n65==5 | n66==5 | n67==5 | n68==5 | n69==5 | n70==5 | n71==5 | n72==5 | n73==5 | n74==5 | n75==5 | n76==5 | n77==5 | n78==5 | n79==5 | n80==5 | n81==5 | n82==5 | n83==5 | n84==5 | n85==5 | n86==5 | n87==5 | n88==5 | n89==5 | n90==5;
			im(x,y,1)=0;
			im(x,y,2)=0;
			im(x,y,3)=255;
			deg=deg+3;
			k3=k3+1;
		else
			im(x,y,1)=255;
			im(x,y,2)=255;
			im(x,y,3)=255;
			deg=deg+2;
			k2=k2+1;
		end
	end


	if grado(nodo)==6
		n91=p(2)+p(4)+p(5)+p(6)+p(7)+p(8);
		n92=p(1)+p(2)+p(4)+p(6)+p(7)+p(8);
		n93=p(1)+p(2)+p(3)+p(4)+p(6)+p(8);
		n94=p(2)+p(3)+p(4)+p(5)+p(6)+p(8);
		n95=p(3)+p(4)+p(5)+p(6)+p(7)+p(8);
		n96=p(1)+p(2)+p(5)+p(6)+p(7)+p(8);
		n97=p(1)+p(2)+p(3)+p(4)+p(7)+p(8);
		n98=p(1)+p(2)+p(3)+p(4)+p(5)+p(6);
		n99=p(1)+p(2)+p(3)+p(6)+p(7)+p(8);
		n100=p(1)+p(2)+p(3)+p(4)+p(5)+p(8);
		n101=p(2)+p(3)+p(4)+p(5)+p(6)+p(7);
		n102=p(1)+p(4)+p(5)+p(6)+p(7)+p(8);

		if n91==6 | n92==6 | n93==6 | n94==6 | n95==6 | n96==6 | n97==6 | n98==6 | n99==6 | n100==6 | n101==6 | n102==6;
			im(x,y,1)=0;
			im(x,y,2)=0;
			im(x,y,3)=255;
			deg=deg+3;
			k3=k3+1;
		else
			im(x,y,1)=255;
			im(x,y,2)=255;
			im(x,y,3)=255;
			deg=deg+2;
			k2=k2+1;
		end
	end


	nodes=nodes+1;

end

display(deg/nodes);
image(im);

